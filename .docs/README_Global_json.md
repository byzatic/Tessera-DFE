# Global.json — Глобальная конфигурация для Tessera Data Flow Engine

Файл `Global.json` определяет **глобальные хранилища** и **сервисы**, доступные всем workflow-рутине и пайплайнам проекта Tessera-DFE.

Он располагается по следующему пути:

```
MyAwesomeProject/
└── data/
    └── Global.json
```

Файл содержит два массива верхнего уровня:

- `storages`: глобально зарегистрированные хранилища данных, используемые узлами и сервисами.
- `services`: глобально зарегистрированные сервисы, реализующие интерфейс из `tessera-service-lib`.

---

## Структура

```json
{
  "storages": [
    {
      "id_name": "PROMETHEUS_DATA_STORAGE",
      "description": "Storage for publishing to Prometheus",
      "options": [
        {
          "key": "LogDumpOnError",
          "value": "true"
        },
        {
          "key": "ExceptOnCreate",
          "value": "true"
        }
      ]
    }
  ],
  "services": [
    {
      "id_name": "PrometheusExportService",
      "description": "Service Prometheus data uploading (Poll)",
      "options": [
        {
          "data": "PROMETHEUS_DATA_STORAGE",
          "name": "storage"
        },
        {
          "data": "6",
          "name": "expiredMinutesAgo"
        },
        {
          "data": "http://0.0.0.0:8080/metrics",
          "name": "apiURL"
        },
        {
          "data": "*/1 * * * * ?",
          "name": "cronMetricUpdateString"
        }
      ]
    }
  ]
}
```

---

## Storages (Хранилища)

Глобальные хранилища — это именованные контейнеры для промежуточных или итоговых данных, доступные разным workflow.

### Поля:

- `id_name`: уникальный идентификатор хранилища.
- `description`: описание.
- `options`: массив параметров (ключ-значение).

### Доступные опции:

| Ключ               | Назначение                                                                 |
|--------------------|----------------------------------------------------------------------------|
| `LogDumpOnError`   | При значении `true` логирует содержимое стоража в случае ошибки.           |
| `ExceptOnCreate`   | При значении `true` генерирует исключение, если хранилище уже существует.  |

---

## Services (Сервисы)

Сервисы реализуют периодические задачи и побочные действия через `tessera-service-lib`.

### Поля:

- `id_name`: идентификатор сервиса (должен соответствовать имени реализации).
- `description`: описание сервиса.
- `options`: массив параметров (см. ниже).

Каждая `option` определяется в следующем формате:

```json
{
  "data": "<значение>",
  "name": "<имя_параметра>"
}
```

В последующих обновлениях будут переименованы в (с сохранением обратной совместимости):

```json
{
  "key": "<имя_параметра>",
  "value": "<значение>"
}
```

### Пример: `PrometheusExportService`

| Имя параметра          | Назначение                                           |
|------------------------|------------------------------------------------------|
| `storage`              | ID глобального хранилища, из которого читать данные  |
| `expiredMinutesAgo`    | Давность данных, которые можно экспортировать (в минутах) |
| `apiURL`               | HTTP-адрес для публикации метрик Prometheus         |
| `cronMetricUpdateString` | Cron выражение для запуска                         |

---

## Соглашения

- Все `id_name` сторажей должны быть **уникальны**.
- Параметры сервиса должны соответствовать его реализации.

---

## Использование в пайплайнах

Все глобальные `storages` автоматически доступны в каждом:

```
data/nodes/**/pipeline.json
```

Рутины могут ссылаться на эти объекты через API описано в tessera-workflowroutine-lib.

---

## Рекомендации

- Описывайте только те сторажи, которые действительно **используются сервисами DataFlow**.
- Не злоупотребляйте глобальной областью — локальные конфигурации предпочтительнее, если они подходят.

---

## Расширение

Чтобы добавить новый сервис или хранилище:

1. Добавьте его в `Global.json`.
2. Убедитесь, что реализация присутствует в `modules/`.

---