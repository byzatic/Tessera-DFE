# Конфигурирование Tessera DFE

Движок Tessera использует XML-файл конфигурации и класс
`Configuration.java` для загрузки параметров исполнения,
cron-планирования, системных путей и параметров наблюдаемости.

------------------------------------------------------------------------

## Конфигурационный файл: `configuration.xml`

Файл должен быть размещён в виде `configuration.xml` и доступен через
путь, передаваемый в движок (системное свойство JVM
`-DconfigFilePath=...`).

### Использование

``` bash
java -DconfigFilePath=configuration.xml -jar tessera-engine.jar
```

------------------------------------------------------------------------

## Пример содержимого

``` xml
<Configuration>
    <graphCalculationCronCycle>*/10 * * * * *</graphCalculationCronCycle>
    <initializeStorageByRequest>false</initializeStorageByRequest>
    <dataDirectory>/My/Awesome/Data/Directory</dataDirectory>
    <projectName>MyAwesomeProject</projectName>

    <prometheusURI>http://0.0.0.0:9090/metrics</prometheusURI>
    <jvmMetricsEnabled>false</jvmMetricsEnabled>
    <publishNodePipelineExecutionTime>false</publishNodePipelineExecutionTime>
</Configuration>
```

------------------------------------------------------------------------

## Таблица параметров

  ------------------------------------------------------------------------------------------------
Параметр                              Описание
  ------------------------------------- ----------------------------------------------------------
`graphCalculationCronCycle`           Cron-выражение для запуска `graphManager`. Поддерживается
5 или 6 полей
(`[секунды] минуты часы день-месяца месяц день-недели`).
Quartz-токены (`?`, `L`, `W`, `#`) не поддерживаются.

`initializeStorageByRequest`          Булево значение (`true`/`false`). **Не рекомендуется к
использованию** --- параметр непротестирован. Включать
только при осознанной необходимости.

`dataDirectory`                       Абсолютный путь к каталогу данных, используемому системой
для загрузки проектов.

`projectName`                         Человекочитаемое имя проекта, используемое движком для
идентификации в `dataDirectory`.

`prometheusURI`                       HTTP-адрес эндпоинта, на котором Tessera публикует метрики
в формате Prometheus (`/metrics`).

`jvmMetricsEnabled`                   Булево значение (`true`/`false`). Включает публикацию
JVM-метрик (heap, GC, threads и др.) в
Prometheus-эндпоинт.

`publishNodePipelineExecutionTime`    Булево значение (`true`/`false`). Публикует метрику
времени выполнения узлов пайплайна. **Снижает
производительность**. Использовать только для отладки
графа.
  ------------------------------------------------------------------------------------------------

------------------------------------------------------------------------

## Синтаксис Cron

### Формат

    секунды минуты часы день-месяца месяц день-недели

Если указано только 5 полей, поле `секунды` принимается равным `0`.

### Поддерживаемые токены

-   `*` --- любое значение\
-   точное число (например, `5`)\
-   диапазон (`a-b`)\
-   список (`a,b,c`)\
-   шаг (`*/n`)\
-   диапазон со шагом (`a-b/n`)

### Ограничения

-   Quartz-токены `?`, `L`, `W`, `#` не поддерживаются\
-   `Day-of-Week` использует диапазон `0–6`, где `0 = Sunday`\
-   Для совпадения требуется выполнение обоих условий: `Day-of-Month`
    **и** `Day-of-Week`

------------------------------------------------------------------------

## Примеры Cron

-   `*/10 * * * * *` --- каждые 10 секунд\
-   `0 */5 * * * *` --- каждые 5 минут\
-   `0 15 10 * * *` --- каждый день в 10:15:00\
-   `0 0 12 * * 1-5` --- в 12:00:00 с понедельника по пятницу

> Важно: запись Quartz-стиля `*/10 * * * * ?` недопустима.\
> Используйте `*/10 * * * * *`.
